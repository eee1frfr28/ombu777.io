<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>픽셀 캐릭터 발자국</title>
  <!-- p5.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
</head>
<body>
<script>

// ======= 여기에 지금까지 만든 p5.js 코드 전체 붙여넣기 =======

let gridSize = 50;
let cellSize = 6;
let grid = [];
let currentColor;

let charImg;
let trailGraphics;
let prevMouse;

function setup() {
  createCanvas(800, 600);
  noSmooth();
  background(255);

  for(let i=0;i<gridSize;i++){
    grid[i]=[];
    for(let j=0;j<gridSize;j++){
      grid[i][j] = color(255);
    }
  }

  currentColor = color(0);

  trailGraphics = createGraphics(width/2, height);
  trailGraphics.clear();
  trailGraphics.stroke(0);
  trailGraphics.strokeWeight(2);

  prevMouse = createVector(width*0.75, height/2);
}

function draw() {
  background(255);

  stroke(0);
  strokeWeight(2);
  line(width/2,0,width/2,height);
  line(0,height/2,width/2,height/2);

  if(charImg){
    trailGraphics.line(prevMouse.x - width/2, prevMouse.y, mouseX - width/2, mouseY);
    prevMouse.set(mouseX, mouseY);
    image(trailGraphics, width/2, 0);

    imageMode(CENTER);
    image(charImg, mouseX, mouseY, gridSize*cellSize, gridSize*cellSize);
  }

  drawEditor();

  fill(0);
  rect(10, height-60, 30, 30);
  currentColor = color(0);

  fill(0);
  rect(60, height-60, 100, 40);
  fill(255);
  textAlign(CENTER, CENTER);
  text("Create Character", 110, height-40);
}

function drawEditor(){
  for(let i=0;i<gridSize;i++){
    for(let j=0;j<gridSize;j++){
      let c = grid[i][j];
      fill(c);
      stroke(180);
      rect(10 + i*cellSize, 10 + j*cellSize, cellSize, cellSize);
    }
  }
}

function mousePressed(){ paintPixel(); checkButton(); }
function mouseDragged(){ paintPixel(); }

function paintPixel(){
  let x = mouseX - 10;
  let y = mouseY - 10;
  if(x>=0 && y>=0 && x<gridSize*cellSize && y<gridSize*cellSize){
    let i = floor(x/cellSize);
    let j = floor(y/cellSize);
    grid[i][j] = currentColor;
  }
}

function checkButton(){
  if(mouseX>=60 && mouseX<=160 && mouseY>=height-60 && mouseY<=height-20){
    charImg = getCharacterImage();
  }
}

function getCharacterImage(){
  let img = createImage(gridSize, gridSize);
  img.loadPixels();
  for(let i=0;i<gridSize;i++){
    for(let j=0;j<gridSize;j++){
      let c = grid[i][j];
      if(red(c)==0 && green(c)==0 && blue(c)==0){
        img.set(i,j,color(0,0,0,255));
      } else {
        img.set(i,j,color(0,0,0,0));
      }
    }
  }
  img.updatePixels();
  return img;
}

</script>
</body>
</html>

